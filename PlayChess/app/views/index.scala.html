@(message: String)

@main("Welcome to PlayChess") {

    <script type="text/javascript">
        var pieces = {
            white : {
                king : '\u2654',
                queen : '\u2655',
                rook : '\u2656',
                bishop : '\u2657',
                knight : '\u2658',
                pawn : '\u2659'
            },
            black : {
                king : '\u265A',
                queen : '\u265B',
                rook : '\u265C',
                bishop : '\u265D',
                knight : '\u265E',
                pawn : '\u265F'
            }
        };

        $(document).ready(function() {
            setDefaultBackground();

            $('#board > tbody > tr').each(function() {
                $(this).children().each(function() {
                    $(this).addClass('tile');
                });
            });

            $('#board > tbody > tr').each(function() {
                if ($(this).index() < 8) {
                    $(this).children().each(function() {
                        if ($(this).index() < 8) {
                            $(this).addClass('spot');
                        }
                    });
                }
            });

            $('#board > tbody > tr > td').height($('#board > tbody > tr > td').width());

            setDefaultBoard();
        });

        $(window).resize(function () {
            var cw = $('.tile').width();
            $('.tile').height(cw);
            $('.spot').css('font-size', cw);
        });

        // functions
        function setDefaultBackground() {
            $('#board > tbody > tr').each(function() {
                if($(this).index() % 2 === 0) {
                    if ($(this).index() < 8) {
                        $(this).children('td').each(function() {
                            if($(this).index() % 2 === 1) {
                                $(this).addClass('bgGray');
                            }
                            else {
                                if ($(this).index() < 8) {
                                    $(this).addClass('bgWhite');
                                }
                            }
                        });
                    }
                }
                else {
                    $(this).children('td').each(function() {
                        if($(this).index() % 2 === 0) {
                            if ($(this).index() < 8) {
                                $(this).addClass('bgGray');
                            }
                        }
                        else {
                            $(this).addClass('bgWhite');
                        }
                    });
                }
            });

            $('#board > tbody > tr > td').each(function() {
                $(this).removeClass('selected');
                $(this).removeClass('highlight');
            });
        }

        function setDefaultBoard() {
            $('#board > tbody > tr').each(function() {
                if ($(this).index() == 0) {
                    $(this).children('td').each(function () {
                        if ($(this).index() == 0 || $(this).index() == 7) {
                            $(this).append(pieces.black.rook);
                        }
                        if ($(this).index() == 1 || $(this).index() == 6) {
                            $(this).append(pieces.black.knight);
                        }
                        if ($(this).index() == 2 || $(this).index() == 5) {
                            $(this).append(pieces.black.bishop);
                        }
                        if ($(this).index() == 3) {
                            $(this).append(pieces.black.queen);
                        }
                        if ($(this).index() == 4) {
                            $(this).append(pieces.black.king);
                        }
                    });
                }
                if ($(this).index() == 1) {
                    $(this).children('td').each(function () {
                        if ($(this).index() < 8) {
                            $(this).append(pieces.black.pawn);
                        }
                    });
                }
                if ($(this).index() == 6) {
                    $(this).children('td').each(function () {
                        if ($(this).index() < 8) {
                            $(this).append(pieces.white.pawn);
                        }
                    });
                }
                if ($(this).index() == 7) {
                    $(this).children('td').each(function () {
                        if ($(this).index() == 0 || $(this).index() == 7) {
                            $(this).append(pieces.white.rook);
                        }
                        if ($(this).index() == 1 || $(this).index() == 6) {
                            $(this).append(pieces.white.knight);
                        }
                        if ($(this).index() == 2 || $(this).index() == 5) {
                            $(this).append(pieces.white.bishop);
                        }
                        if ($(this).index() == 3) {
                            $(this).append(pieces.white.queen);
                        }
                        if ($(this).index() == 4) {
                            $(this).append(pieces.white.king);
                        }
                    });
                }
            });
        }

        $(document).ready(function() {
            $('.spot').click(function() {
                setDefaultBackground();
                var x = $(this).parent().children().index($(this));
                var y = $(this).parent().parent().children().index($(this).parent());
                $(this).addClass('selected');

                $.ajax({
                    type: "GET",
                    url: "/click?x=" + x + "&y=" + y,
                    dataType: "json"
                }).done(function(data) {
                    highlight(data);
                });
            });
        });

        function highlight(points) {
            for (p in points) {
                $('#board > tbody > tr').each(function() {
                    if ($(this).index() == points[p].y) {
                        $(this).children().each(function() {
                            if($(this).index() == points[p].x) {
                                $(this).addClass('highlight');
                            }
                        });
                    }
                });
            }
        }

        // assume black is true
        function addToCaptureList(color, piece) {
            if (color) {
                $('#bCap').append(
                    $('<li>').append(piece)
                );
            } else {
                $('#wCap').append(
                    $('<li>').append(piece)
                );
            }
        }


        // testing grounds
        $(document).ready(function() {
            addToCaptureList(true, pieces.white.queen);
            addToCaptureList(true, pieces.white.pawn);
            addToCaptureList(true, pieces.white.pawn);
            addToCaptureList(true, pieces.white.queen);
            addToCaptureList(true, pieces.white.pawn);
            addToCaptureList(true, pieces.white.queen);
            addToCaptureList(true, pieces.white.pawn);
            addToCaptureList(true, pieces.white.queen);
            addToCaptureList(true, pieces.white.pawn);
            addToCaptureList(true, pieces.white.pawn);
            addToCaptureList(true, pieces.white.queen);
            addToCaptureList(true, pieces.white.pawn);
            addToCaptureList(true, pieces.white.pawn);
            addToCaptureList(true, pieces.white.pawn);

            addToCaptureList(false, pieces.black.knight);
            addToCaptureList(false, pieces.black.rook);
            addToCaptureList(false, pieces.black.bishop);
            addToCaptureList(false, pieces.black.rook);
            addToCaptureList(false, pieces.black.bishop);
            addToCaptureList(false, pieces.black.rook);
            addToCaptureList(false, pieces.black.bishop);
            addToCaptureList(false, pieces.black.rook);
            addToCaptureList(false, pieces.black.bishop);
            addToCaptureList(false, pieces.black.knight);
            addToCaptureList(false, pieces.black.bishop);
            addToCaptureList(false, pieces.black.rook);
            addToCaptureList(false, pieces.black.knight);
        });

    </script>

    <style type="text/css">
        .tile {
            min-width: 75px;
            min-height: 75px;
            max-width: 100px;
            max-height: 100px;
            width: auto;
            height: auto;
            font-size: 75px;
            text-align: center !important;
            vertical-align: middle !important;
        }

        .spot {}

        .bgGray {
            background-color: gray;
        }

        .bgWhite {
            background-color: white;
        }

        .selected {
            background-color: #00FFFF;
        }

        .highlight {
            background-color: #00FF00;
        }

        #board {
            position: relative;
            float: left;
            min-width: 700px;
            min-height: 700px;
            max-width: 850px;
            max-height: 850px;
        }

        .capture {
            float: left;
        }

        .capture {
            display: inline-block;
            position: relative;
            float: right;
            min-width: 250px;
            max-width: 300px;
            list-style-type: none;
            font-size: 50px;
            overflow: auto;
            margin: 0px;
        }

        .capture li {
            float: right;
            width: 75px;
            height: 75px;
            font-size: 60px;
            text-align: center !important;
            vertical-align: bottom !important;
            line-height: 75px;
        }

        h4 {
            float: right;
        }

    </style>

    <div>
        <h3>@message</h3>
    </div>

    <div>
        <table id="board" class="table table-bordered">
            <thead>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>1</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>2</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>3</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>4</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>5</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>6</td>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>7</td>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>8</td>
                </tr>
                <tr>
                    <td>A</td>
                    <td>B</td>
                    <td>C</td>
                    <td>D</td>
                    <td>E</td>
                    <td>F</td>
                    <td>G</td>
                    <td>H</td>
                    <td></td>
                </tr>
            </tbody>
            <tfoot>
            </tfoot>
        </table>

        <div class='captureBar'>
            <h4>Captured pieces</h4>
            <ul id="bCap" class="capture">
            </ul>
            <ul id="wCap" class="capture">
            </ul>
        </div>
    </div>

}
